<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monthly To-Do Tracker</title>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide icons as inline SVG components
    const ChevronDown = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="6 9 12 15 18 9"></polyline>
      </svg>
    );

    const Plus = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const Trash2 = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="3 6 5 6 21 6"></polyline>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
        <line x1="10" y1="11" x2="10" y2="17"></line>
        <line x1="14" y1="11" x2="14" y2="17"></line>
      </svg>
    );

    const Download = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="7 10 12 15 17 10"></polyline>
        <line x1="12" y1="15" x2="12" y2="3"></line>
      </svg>
    );

    const Upload = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
    );

    const Moon = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    );

    const Sun = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
    );

    const Check = () => (
      <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    );

    // Utility: Get weeks in a month with dates
    const getWeeksInMonth = (year, month) => {
      const weeks = [];
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      
      let currentWeek = [];
      let weekNum = 1;
      
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = new Date(year, month, day);
        currentWeek.push(day);
        
        if (date.getDay() === 0 || day === lastDay.getDate()) {
          weeks.push({
            weekNum,
            days: [...currentWeek],
            startDate: currentWeek[0],
            endDate: currentWeek[currentWeek.length - 1]
          });
          currentWeek = [];
          weekNum++;
        }
      }
      
      return weeks;
    };

    // Utility: Generate storage key
    const getStorageKey = (year, month) => `todo-${year}-${month}`;

    function MonthlyTodoTracker() {
      const currentDate = new Date();
      const [selectedYear, setSelectedYear] = useState(currentDate.getFullYear());
      const [selectedMonth, setSelectedMonth] = useState(currentDate.getMonth());
      const [tasks, setTasks] = useState({});
      const [darkMode, setDarkMode] = useState(false);
      const [showStats, setShowStats] = useState(true);

      // Load tasks from storage
      useEffect(() => {
        const key = getStorageKey(selectedYear, selectedMonth);
        const stored = localStorage.getItem(key);
        
        if (stored) {
          try {
            setTasks(JSON.parse(stored));
          } catch (e) {
            console.error('Failed to parse stored tasks:', e);
            setTasks({});
          }
        } else {
          setTasks({});
        }
      }, [selectedYear, selectedMonth]);

      // Save tasks to storage
      useEffect(() => {
        const key = getStorageKey(selectedYear, selectedMonth);
        localStorage.setItem(key, JSON.stringify(tasks));
      }, [tasks, selectedYear, selectedMonth]);

      // Generate years for dropdown (current year Â± 5 years)
      const years = Array.from({ length: 11 }, (_, i) => currentDate.getFullYear() - 5 + i);
      const months = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];

      const weeks = getWeeksInMonth(selectedYear, selectedMonth);

      // Add new task to a week
      const addTask = (weekNum) => {
        const weekKey = `week-${weekNum}`;
        const weekTasks = tasks[weekKey] || [];
        const newTask = {
          id: Date.now(),
          text: '',
          done: false,
          accepting: 0
        };
        
        setTasks({
          ...tasks,
          [weekKey]: [...weekTasks, newTask]
        });
      };

      // Update task property
      const updateTask = (weekNum, taskId, property, value) => {
        const weekKey = `week-${weekNum}`;
        const weekTasks = tasks[weekKey] || [];
        
        setTasks({
          ...tasks,
          [weekKey]: weekTasks.map(task =>
            task.id === taskId ? { ...task, [property]: value } : task
          )
        });
      };

      // Delete task
      const deleteTask = (weekNum, taskId) => {
        const weekKey = `week-${weekNum}`;
        const weekTasks = tasks[weekKey] || [];
        
        setTasks({
          ...tasks,
          [weekKey]: weekTasks.filter(task => task.id !== taskId)
        });
      };

      // Export data
      const exportData = () => {
        const dataStr = JSON.stringify(tasks, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `todo-${selectedYear}-${selectedMonth + 1}.json`;
        a.click();
        URL.revokeObjectURL(url);
      };

      // Import data
      const importData = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            setTasks(imported);
          } catch (err) {
            alert('Failed to import data. Please check the file format.');
          }
        };
        reader.readAsText(file);
      };

      // Calculate statistics
      const getStats = () => {
        let total = 0;
        let completed = 0;
        
        Object.values(tasks).forEach(weekTasks => {
          weekTasks.forEach(task => {
            if (task.text.trim()) {
              total++;
              if (task.done) completed++;
            }
          });
        });
        
        return { total, completed, percentage: total > 0 ? Math.round((completed / total) * 100) : 0 };
      };

      const stats = getStats();

      return (
        <div className={`min-h-screen ${darkMode ? 'bg-gray-900 text-white' : 'bg-gray-50 text-gray-900'}`}>
          {/* Header */}
          <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} shadow-sm sticky top-0 z-10`}>
            <div className="max-w-7xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between mb-4">
                <h1 className="text-2xl font-bold">Monthly To-Do Tracker</h1>
                
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => setShowStats(!showStats)}
                    className={`px-3 py-2 rounded-lg text-sm font-medium ${
                      darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                    }`}
                  >
                    {showStats ? 'Hide' : 'Show'} Stats
                  </button>
                  
                  <label className={`px-3 py-2 rounded-lg cursor-pointer text-sm font-medium ${
                    darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                  }`}>
                    <Upload /> Import
                    <input type="file" accept=".json" onChange={importData} className="hidden" />
                  </label>
                  
                  <button
                    onClick={exportData}
                    className={`px-3 py-2 rounded-lg text-sm font-medium ${
                      darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                    }`}
                  >
                    <Download /> Export
                  </button>
                  
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className={`p-2 rounded-lg ${
                      darkMode ? 'bg-gray-700 hover:bg-gray-600' : 'bg-gray-100 hover:bg-gray-200'
                    }`}
                  >
                    {darkMode ? <Sun /> : <Moon />}
                  </button>
                </div>
              </div>

              {/* Month/Year Selector */}
              <div className="flex items-center gap-4">
                <div className="relative">
                  <select
                    value={selectedMonth}
                    onChange={(e) => setSelectedMonth(parseInt(e.target.value))}
                    className={`appearance-none px-4 py-2 pr-10 rounded-lg font-medium cursor-pointer ${
                      darkMode ? 'bg-gray-700' : 'bg-gray-100'
                    }`}
                  >
                    {months.map((month, idx) => (
                      <option key={idx} value={idx}>{month}</option>
                    ))}
                  </select>
                  <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                    <ChevronDown />
                  </div>
                </div>

                <div className="relative">
                  <select
                    value={selectedYear}
                    onChange={(e) => setSelectedYear(parseInt(e.target.value))}
                    className={`appearance-none px-4 py-2 pr-10 rounded-lg font-medium cursor-pointer ${
                      darkMode ? 'bg-gray-700' : 'bg-gray-100'
                    }`}
                  >
                    {years.map(year => (
                      <option key={year} value={year}>{year}</option>
                    ))}
                  </select>
                  <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none">
                    <ChevronDown />
                  </div>
                </div>
              </div>

              {/* Stats Bar */}
              {showStats && (
                <div className={`mt-4 p-4 rounded-lg ${darkMode ? 'bg-gray-700' : 'bg-blue-50'}`}>
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium">Monthly Progress</span>
                    <span className="text-sm font-bold">{stats.completed}/{stats.total} tasks ({stats.percentage}%)</span>
                  </div>
                  <div className={`w-full h-2 rounded-full overflow-hidden ${darkMode ? 'bg-gray-600' : 'bg-gray-200'}`}>
                    <div
                      className="h-full bg-blue-500 transition-all duration-300"
                      style={{ width: `${stats.percentage}%` }}
                    />
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Weeks Grid */}
          <div className="max-w-7xl mx-auto px-4 py-6">
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
              {weeks.map(week => {
                const weekKey = `week-${week.weekNum}`;
                const weekTasks = tasks[weekKey] || [];
                const completedCount = weekTasks.filter(t => t.done && t.text.trim()).length;
                const totalCount = weekTasks.filter(t => t.text.trim()).length;

                return (
                  <div
                    key={week.weekNum}
                    className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-lg shadow-sm p-5`}
                  >
                    {/* Week Header */}
                    <div className="flex items-center justify-between mb-4">
                      <div>
                        <h2 className="text-lg font-bold">Week {week.weekNum}</h2>
                        <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                          {months[selectedMonth]} {week.startDate}-{week.endDate}
                        </p>
                      </div>
                      <div className="text-right">
                        <div className="text-sm font-medium">
                          {completedCount}/{totalCount}
                        </div>
                        {totalCount > 0 && (
                          <div className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-500'}`}>
                            {Math.round((completedCount / totalCount) * 100)}%
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Tasks */}
                    <div className="space-y-3">
                      {weekTasks.map(task => (
                        <div key={task.id} className="flex items-start gap-3 group">
                          {/* Checkbox */}
                          <button
                            onClick={() => updateTask(week.weekNum, task.id, 'done', !task.done)}
                            className={`mt-1 w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0 transition-colors ${
                              task.done
                                ? 'bg-blue-500 border-blue-500'
                                : darkMode
                                ? 'border-gray-600 hover:border-gray-500'
                                : 'border-gray-300 hover:border-gray-400'
                            }`}
                          >
                            {task.done && <Check />}
                          </button>

                          {/* Task Text */}
                          <input
                            type="text"
                            value={task.text}
                            onChange={(e) => updateTask(week.weekNum, task.id, 'text', e.target.value)}
                            placeholder="Enter task..."
                            className={`flex-1 px-3 py-2 rounded border ${
                              task.done ? 'line-through opacity-60' : ''
                            } ${
                              darkMode
                                ? 'bg-gray-700 border-gray-600 focus:border-blue-500'
                                : 'bg-white border-gray-300 focus:border-blue-500'
                            } outline-none transition-colors`}
                          />

                          {/* Accepting Number */}
                          <input
                            type="number"
                            value={task.accepting}
                            onChange={(e) => updateTask(week.weekNum, task.id, 'accepting', parseInt(e.target.value) || 0)}
                            className={`w-16 px-2 py-2 rounded border text-center ${
                              darkMode
                                ? 'bg-gray-700 border-gray-600 focus:border-blue-500'
                                : 'bg-white border-gray-300 focus:border-blue-500'
                            } outline-none transition-colors`}
                            min="0"
                          />

                          {/* Delete Button */}
                          <button
                            onClick={() => deleteTask(week.weekNum, task.id)}
                            className={`p-2 rounded opacity-0 group-hover:opacity-100 transition-opacity ${
                              darkMode ? 'hover:bg-gray-700 text-red-400' : 'hover:bg-gray-100 text-red-500'
                            }`}
                          >
                            <Trash2 />
                          </button>
                        </div>
                      ))}

                      {/* Add Task Button */}
                      <button
                        onClick={() => addTask(week.weekNum)}
                        className={`w-full py-2 rounded-lg border-2 border-dashed flex items-center justify-center gap-2 transition-colors ${
                          darkMode
                            ? 'border-gray-700 hover:border-gray-600 hover:bg-gray-700'
                            : 'border-gray-300 hover:border-gray-400 hover:bg-gray-50'
                        }`}
                      >
                        <Plus />
                        <span className="text-sm font-medium">Add Task</span>
                      </button>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<MonthlyTodoTracker />, document.getElementById('root'));
  </script>
</body>
</html>
